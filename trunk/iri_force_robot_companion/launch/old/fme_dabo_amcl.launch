<!-- -->
<launch>


  <!-- load robot defined machines -->
  <include file="$(find tibi_dabo_base)/machines/$(env ROBOT).machines" />

  <!-- Navigation Sensors -->
  <include file="$(find tibi_dabo_base)/launch/tibi_dabo_nav_sensors.launch">
    <arg name="launch_teleop" value="False" />
    <arg name="launch_rviz" value="False" />
  </include>


  <!-- fme environment -->

  <include file="$(find tibi_dabo_base)/launch/fme.launch" />


<group ns="$(env ROBOT)">

	<node name="map_server" 
		pkg="map_server" 
		type="map_server" 
		args="$(find tibi_dabo_rosnav)/maps/fmedabo.yaml" 
		machine="nav">
			<param name="frame_id" value="/map" />			
	</node>

	<!-- start AMCL -->
	<node name="amcl" 
		pkg="amcl" 
		type="amcl"
		machine="nav">
			<remap from="scan" to="/$(env ROBOT)/front_laser/scan"/>
			<param name="odom_frame_id" value="/$(env ROBOT)/odom" />
			<param name="base_frame_id" value="/$(env ROBOT)/base_link" />
			<param name="global_frame_id" value="/map" />
			<param name="min_particles" value="100" />
			<param name="max_particles" value="500" />
			<param name="initial_pose_x" value="0" />
			<param name="initial_pose_y" value="0" />
			<param name="initial_pose_a" value="0" />
			<param name="gui_publish_rate" value="1" />
	</node>

    <!-- people detector -->
    <node pkg ="iri_laser_people_detection"
          type="iri_laser_people_detection"
          name="iri_laser_people_detection"
          machine="nav">
      <param name="~/range_threshold" value="40.0" type="double"/>
      <param name="~/detection_threshold" value="-0.1" type="double"/>
      <param name="~/markerSize"      value="0.4" type="double"/>
      <remap from="/$(env ROBOT)/iri_laser_people_detection/scan"
             to="/$(env ROBOT)/front_laser/scan" />
    </node>

 
    <!-- people tracker -->
    <node pkg ="iri_people_tracking"
          type="iri_people_tracking"
          name="iri_people_tracking"
		  machine="nav">
      <remap from="/$(env ROBOT)/iri_people_tracking/people_detection"
               to="/$(env ROBOT)/iri_laser_people_detection/people" />
	<remap from="/$(env ROBOT)/iri_people_tracking/odom"
               to="/$(env ROBOT)/segway_rmp200_odom/odom" />
    </node>


   <!-- wiimote node -->
    <node pkg ="wiimote"
          type="wiimote_node.py"
          name="joy"
          machine="nav"
          respawn="true"/>


    <!-- no collision -->
    <node pkg ="iri_no_collision"
          type="iri_no_collision"
          name="iri_no_collision"
          machine="nav"
          output="screen">
      <remap from="/$(env ROBOT)/iri_no_collision/scan"
               to="/$(env ROBOT)/front_laser/scan" />
      <remap from="/$(env ROBOT)/iri_no_collision/segway_cmd" 
               to="/$(env ROBOT)/iri_segway_rmp200/cmd_vel" />
      <remap from="/$(env ROBOT)/iri_no_collision/segway_odom"
               to="/$(env ROBOT)/iri_segway_rmp200_odom/odom" />
      <remap from="/$(env ROBOT)/iri_no_collision/target_vel"
               to="/$(env ROBOT)/iri_force_robot_companion/velocity" />
      <param name="~tf_prefix" value="/$(env ROBOT)" />
      <param name="~r_acc"  value="1.0" />
      <param name="~vR_max" value="1.0" />
      <param name="~vT_max"  value="1.0" />
   </node>



  <!-- Force robot companion -->
  <node pkg ="iri_force_robot_companion"
        type="iri_force_robot_companion"
        name="iri_force_robot_companion" 
	machine="nav"
	output="screen">
		<param name="move_base" value="False"/>
		<param name="robot_sim" value="False"/>
		<param name="using_prediction" value="True"/>
		<param name="time_horizon" value="5.0"/>
		<param name="reference_frame" value="/map"/>
		<param name="v_max" value="1.0"/>
		<param name="v_cruise" value="1.0"/>
		<param name="r" value="0.0"/>
		<remap from="/$(env ROBOT)/iri_force_robot_companion/tracks"
               to="/$(env ROBOT)/iri_people_tracking/peopleSet" />
		<remap from="/$(env ROBOT)/move_base"
			to="/$(env ROBOT)/iri_no_collision/MoveBase" />
		<remap from="/$(env ROBOT)/iri_force_robot_companion/joy"
               to="/$(env ROBOT)/joy" />
  </node>

</group>

  <node pkg ="rviz" 
        name="rviz" 
        type="rviz" 
        args="-d $(find iri_force_robot_companion)/config/fme_companion.vcg"
				machine="monitor"
         />

</launch>


